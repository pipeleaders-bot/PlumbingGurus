<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart AI Estimate | Plumbing Gurus</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f4f4f4; color:#333; }
header { background:#fff; padding:15px 30px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #e0e0e0; }
.header-left { display:flex; align-items:center; gap:25px; }
.header-left img { height:85px; object-fit:contain; }
nav a { margin:0 12px; text-decoration:none; font-weight:600; color:#00539C; }
nav a:hover { color:#FF6600; }
.header-phone { font-weight:bold; color:#FF6600; }
.header-right img { height:60px; object-fit:contain; }
@media(max-width:768px){ nav,.header-phone{display:none;} header{padding:10px 15px;} .header-left img{height:65px;} .header-right img{height:45px; max-width:130px;} }
.hero { background: linear-gradient(135deg,#e6f0fa,#fff); text-align:center; padding:40px 20px; }
.hero h1 { color:#00539C; font-size:2.3em; }
.section { max-width:900px; background:#fff; margin:40px auto; padding:30px; border-radius:12px; }
input, select, textarea { width:100%; padding:12px; margin-top:8px; border-radius:8px; border:1px solid #ccc; }
button { margin-top:15px; background:#FF6600; color:#fff; border:none; padding:12px; border-radius:8px; font-size:1em; cursor:pointer; }
button:hover { opacity:0.9; }
#chatBox { margin-top:15px; padding:15px; background:#f9f9f9; border-radius:10px; min-height:180px; overflow:auto; }
.message { margin:8px 0; padding:10px 14px; border-radius:10px; max-width:80%; clear:both; }
.ai { background:#e6f0fa; color:#00539C; float:left; }
.user { background:#FF6600; color:#fff; float:right; }
#estimateResult { margin-top:20px; padding:15px; background:#e6f7ff; border-radius:8px; font-weight:bold; text-align:center; }
footer { text-align:center; padding:20px; font-size:0.9em; background:#222; color:#fff; }
</style>
</head>
<body>

<header>
  <div class="header-left">
    <img src="images/LOGO.png" alt="Plumbing Gurus Logo">
    <nav>
      <a href="index.html">Home</a>
      <a href="services.html">Services</a>
      <a href="estimate-booking.html">Estimate</a>
      <a href="contact.html">Contact</a>
    </nav>
    <span class="header-phone">(210) 906-8524</span>
  </div>
  <div class="header-right">
    <img src="Logo.png" alt="Alternate Logo">
  </div>
</header>

<div class="hero">
  <h1>Smart AI Plumbing Estimate</h1>
  <p>Describe your plumbing problem and get a dynamic, AI-powered preliminary estimate instantly.</p>
</div>

<div class="section">
  <h2>Customer Info</h2>
  <input type="text" id="name" placeholder="Your Name">
  <input type="email" id="email" placeholder="Email">
  <input type="text" id="phone" placeholder="Phone Number">
  <button id="startChatBtn">Start Estimate</button>

  <div id="chatBox"></div>
  <input type="text" id="userInput" placeholder="Type your problem..." disabled>
  <button id="restartBtn" style="display:none;">Start New Estimate</button>
  <div id="estimateResult"></div>
</div>

<div class="section">
  <h2>Book Service</h2>
  <form id="bookingForm">
    <label>Property Type</label>
    <select id="property">
      <option>House</option>
      <option>Apartment</option>
      <option>Commercial</option>
    </select>

    <label>Service Type</label>
    <select id="serviceType">
      <option>Repair</option>
      <option>Replacement</option>
      <option>Renovation</option>
    </select>

    <label>Accessibility</label>
    <select id="access">
      <option>Easy</option>
      <option>Difficult</option>
    </select>

    <label>Additional Notes</label>
    <textarea id="details"></textarea>

    <button type="submit">Submit Booking</button>
  </form>
</div>

<footer>
  Â© 2025 Plumbing Gurus. Dispatch & referral services only.
</footer>

<script>
// ===== AI Estimate Chat =====
const chatBox = document.getElementById('chatBox');
const userInput = document.getElementById('userInput');
const startChatBtn = document.getElementById('startChatBtn');
const restartBtn = document.getElementById('restartBtn');
const estimateResult = document.getElementById('estimateResult');

let stage=0;
let userData={name:'',email:'',phone:'',problem:'',detail:'',floor:'',emergency:false};

const serviceCosts={
  Leak:[120,450],
  Clog:[100,300],
  Faucet:[80,160],
  Toilet:[100,300],
  "Water Heater":[150,600],
  Other:[100,500]
};

startChatBtn.addEventListener('click',()=>{
  userData.name=document.getElementById('name').value.trim();
  userData.email=document.getElementById('email').value.trim();
  userData.phone=document.getElementById('phone').value.trim();
  if(!userData.name||!userData.email||!userData.phone){alert("Please fill all fields."); return;}
  chatBox.innerHTML=''; userInput.disabled=false;
  addMessage(`Hi ${userData.name}! Please describe your plumbing problem.`,'ai');
});

restartBtn.addEventListener('click',restartChat);

function addMessage(text,sender='ai'){
  const msg=document.createElement('div');
  msg.className='message '+sender;
  msg.innerHTML=text;
  chatBox.appendChild(msg);
  chatBox.scrollTop=chatBox.scrollHeight;
}

userInput.addEventListener('keypress',function(e){
  if(e.key==='Enter') handleInput();
});

function handleInput(){
  const val=userInput.value.trim();
  if(!val) return;
  addMessage(val,'user'); userInput.value='';
  
  const emergencyKeywords=["emergency","urgent","now","asap","after hours","night","weekend"];
  if(emergencyKeywords.some(k=>val.toLowerCase().includes(k))){
    userData.emergency=true;
    addMessage('âš  Emergency Service detected â€” estimate increased by 25%','ai');
  }
  
  if(stage===0){ userData.problem=val; stage++; askFollowUp(); }
}

function askFollowUp(){
  const text=userData.problem.toLowerCase();
  let options=[];
  if(text.includes("leak")) options=[{text:"ðŸ’§ Dripping Leak",value:"Dripping"},{text:"ðŸš¿ Spraying Leak",value:"Spraying"}];
  else if(text.includes("clog")) options=[{text:"ðŸ½ï¸ Kitchen",value:"Kitchen"},{text:"ðŸš° Bathroom",value:"Bathroom"},{text:"ðŸš½ Toilet",value:"Toilet"}];
  else if(text.includes("faucet")) options=[{text:"ðŸ’§ Dripping Faucet",value:"Dripping"},{text:"âŒ Not Working Faucet",value:"Not working"}];
  else if(text.includes("toilet")) options=[{text:"ðŸ’§ Running Toilet",value:"Running"},{text:"ðŸš½ Not Flushing",value:"Not flushing"}];
  else if(text.includes("water heater")) options=[{text:"ðŸ”¥ Not Heating",value:"Not heating"},{text:"ðŸ’§ Water Heater Leak",value:"Leaking"}];

  if(options.length){
    addMessage("Select the option that best matches your issue:");
    options.forEach(opt=>{
      const b=document.createElement('button');
      b.className='option';
      b.innerHTML=opt.text;
      b.onclick=()=>selectDetail(opt.value);
      chatBox.appendChild(b);
    });
  } else finalizeEstimate();
}

function selectDetail(val){
  userData.detail=val;
  addMessage(val,'user');
  document.querySelectorAll('.option').forEach(b=>b.remove());
  askFloor();
}

function askFloor(){
  addMessage("Which floor is the issue on?");
  ["First Floor","Second Floor","Ground/Basement"].forEach(f=>{
    const b=document.createElement('button');
    b.className='option';
    b.innerHTML=f;
    b.onclick=()=>selectFloor(f);
    chatBox.appendChild(b);
  });
}

function selectFloor(f){
  userData.floor=f;
  addMessage(f,'user');
  document.querySelectorAll('.option').forEach(b=>b.remove());
  finalizeEstimate();
  sendToEmail();
  restartBtn.style.display='inline-block';
}

function finalizeEstimate(){
  let baseRange=serviceCosts.Other;
  const text=userData.problem.toLowerCase();
  if(text.includes("leak")) baseRange=serviceCosts.Leak;
  else if(text.includes("clog")) baseRange=serviceCosts.Clog;
  else if(text.includes("faucet")) baseRange=serviceCosts.Faucet;
  else if(text.includes("toilet")) baseRange=serviceCosts.Toilet;
  else if(text.includes("heater")) baseRange=serviceCosts["Water Heater"];

  let multiplier=1;
  if(userData.floor.toLowerCase().includes("second")) multiplier*=1.15;
  else if(userData.floor.toLowerCase().includes("ground")) multiplier*=1.1;
  if(userData.emergency) multiplier*=1.25;

  estimateResult.innerHTML=`Preliminary Estimate: $${Math.round(baseRange[0]*multiplier)} - $${Math.round(baseRange[1]*multiplier)} (Labor only)<br><em>Adjusted for San Antonio & emergency status.</em>`;
}

function sendToEmail(){
  fetch("https://formsubmit.co/pipeleaders@gmail.com",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify(userData)});
}

function restartChat(){
  stage=0;
  userData={name:'',email:'',phone:'',problem:'',detail:'',floor:'',emergency:false};
  chatBox.innerHTML=''; userInput.value=''; userInput.disabled=true;
  estimateResult.innerHTML=''; restartBtn.style.display='none';
}

// ===== BOOKING FORM =====
document.getElementById('bookingForm').addEventListener('submit',function(e){
  e.preventDefault();
  const data={
    name:userData.name,
    email:userData.email,
    phone:userData.phone,
    property:document.getElementById('property').value,
    service:document.getElementById('serviceType').value,
    access:document.getElementById('access').value,
    details:document.getElementById('details').value
  };
  fetch("https://formsubmit.co/pipeleaders@gmail.com",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify(data)})
  .then(()=>alert("Booking submitted! Our plumbers will contact you shortly."))
  .catch(err=>console.error(err));
});
</script>

</body>
</html>
