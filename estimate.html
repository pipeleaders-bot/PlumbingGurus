<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plumbing Gurus | Smart AI Estimate</title>
<link rel="icon" type="image/png" href="images/LOGO.png">
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f4f4f4; color:#333; }
header { background:#fff; padding:15px 30px; display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; border-bottom:1px solid #e0e0e0; }
.header-left { display:flex; align-items:center; flex-wrap:wrap; }
.header-left img { height:90px; max-width:320px; object-fit:contain; }
nav { margin-left:25px; display:flex; flex-wrap:wrap; }
nav a { color:#00539C; margin:8px 15px; text-decoration:none; font-weight:600; }
nav a:hover { color:#FF6600; }
.header-phone { font-weight:bold; font-size:1.1em; color:#FF6600; margin-left:25px; }
.header-right img { height:80px; max-width:300px; }
.hero { background: linear-gradient(135deg, #e6f0fa, #ffffff); padding:70px 20px; text-align:center; }
.hero h1 { color:#00539C; font-size:2.8em; }
.hero p { font-size:1.2em; max-width:750px; margin:20px auto 35px; line-height:1.6; }
.section { max-width:950px; margin:50px auto; padding:35px; background:#fff; border-radius:12px; box-shadow:0 3px 18px rgba(0,0,0,0.08); }
.section h2 { color:#00539C; margin-bottom:20px; }
form#customerInfo input, form#customerInfo button { width:100%; padding:12px; margin:10px 0; border-radius:8px; border:1px solid #ccc; font-size:1em; }
form#customerInfo button { background:#FF6600; color:white; border:none; cursor:pointer; }
#chatBox { border:1px solid #ccc; padding:20px; border-radius:12px; max-width:600px; margin:20px auto; background:#f9f9f9; min-height:220px; }
.message { margin:12px 0; padding:10px 15px; border-radius:12px; max-width:80%; display:inline-block; }
.user { text-align:right; background:#FF6600; color:white; float:right; }
.ai { text-align:left; background:#e6f0fa; color:#00539C; float:left; }
button.option { background:#FFD700; color:#00539C; padding:12px 20px; margin:8px 5px 5px 0; border:none; border-radius:8px; cursor:pointer; }
button.option:hover { background:#FFC107; }
#estimateResult { margin-top:20px; padding:15px; background:#e6f7ff; border-radius:8px; font-weight:bold; text-align:center; }
button.restart { background:#00539C; color:#FFD700; padding:12px 20px; border:none; border-radius:8px; cursor:pointer; margin-top:15px; display:none; }
@media(max-width:768px){ header{ flex-direction:column; text-align:center; } nav{ justify-content:center; margin:20px 0; } .header-phone{ margin:10px 0; } .header-right img{ display:block; margin:0 auto; } }
</style>
</head>
<body>

<header>
  <div class="header-left">
    <img src="images/LOGO.png" alt="Plumbing Gurus Logo">
    <nav>
      <a href="index.html">Home</a>
      <a href="services.html">Services</a>
      <a href="estimate.html">Estimate</a>
      <a href="booking.html">Book Service</a>
      <a href="contact.html">Contact</a>
    </nav>
    <span class="header-phone">Call Now: (210) 906-8524</span>
  </div>
  <div class="header-right">
    <img src="images/LOGO.png" alt="Alternate Logo">
  </div>
</header>

<div class="hero">
  <h1>Smart AI Plumbing Estimate</h1>
  <p>Enter your info and describe the plumbing issue. Our AI assistant will ask only needed questions and give a realistic range based on local pricing and urgency.</p>
</div>

<div class="section">
  <h2>Customer Info</h2>
  <form id="customerInfo">
    <input type="text" id="name" placeholder="Your Name" required>
    <input type="email" id="email" placeholder="Your Email" required>
    <input type="text" id="phone" placeholder="Phone Number" required>
    <button type="button" id="startChat">Start Estimate</button>
  </form>

  <h2>AI Interactive Chat</h2>
  <div id="chatBox"></div>
  <input type="text" id="userInput" placeholder="Type here..." disabled>
  <button class="restart" id="restartBtn">Start New Estimate</button>
  <div id="estimateResult"></div>
</div>

<footer>
  <p>Â© 2025 Plumbing Gurus. Coordinating & fixture services only.</p>
  <p><a href="terms.html">Terms & Conditions</a> | <a href="privacy.html">Privacy Policy</a></p>
</footer>

<script>
const chatBox = document.getElementById('chatBox');
const userInput = document.getElementById('userInput');
const startChatBtn = document.getElementById('startChat');
const restartBtn = document.getElementById('restartBtn');
const estimateResult = document.getElementById('estimateResult');

let stage = 0;
let userData = { name:'', email:'', phone:'', problem:'', detail:'', floor:'', emergency:false };

const serviceCosts = { "Leak":[120,450], "Clog":[100,300], "Faucet":[80,160], "Toilet":[100,300], "Water Heater":[150,600], "Other":[100,500] };

startChatBtn.addEventListener('click', () => {
  userData.name = document.getElementById('name').value.trim();
  userData.email = document.getElementById('email').value.trim();
  userData.phone = document.getElementById('phone').value.trim();
  if(!userData.name||!userData.email||!userData.phone){ alert("Please fill all fields."); return; }
  chatBox.innerHTML=''; userInput.disabled=false;
  addMessage(`Hi ${userData.name}! Please describe the plumbing problem:`,'ai');
});

restartBtn.addEventListener('click', ()=>{ stage=0; userData={ name:'', email:'', phone:'', problem:'', detail:'', floor:'', emergency:false }; chatBox.innerHTML=''; userInput.value=''; userInput.disabled=true; estimateResult.innerHTML=''; restartBtn.style.display='none'; });

function addMessage(text,sender='ai'){ const msg=document.createElement('div'); msg.className='message '+sender; msg.innerHTML=text; chatBox.appendChild(msg); chatBox.scrollTop=chatBox.scrollHeight; }

userInput.addEventListener('keypress', function(e){ if(e.key==='Enter') handleInput(); });

function handleInput(){
  const val=userInput.value.trim(); if(!val) return; addMessage(val,'user'); userInput.value='';
  const emergencyKeywords=["emergency","urgent","now","asap","after hours","night","weekend"];
  let emergencyDetected=false;
  emergencyKeywords.forEach(k=>{ if(val.toLowerCase().includes(k)) { userData.emergency=true; emergencyDetected=true; }});
  if(emergencyDetected) addMessage('âš  Emergency Service Detected â€” estimate increased by 25%','ai');
  if(stage===0){
    userData.problem=val;
    const floorRegex=/(first floor|second floor|ground floor|basement)/i;
    const floorMatch=val.match(floorRegex); if(floorMatch) userData.floor=floorMatch[0];
    stage++; askFollowUp();
  }
}

function askFollowUp(){
  const text=userData.problem.toLowerCase();
  let options=[];
  if(text.includes("leak")) options=[{text:"ðŸ’§ Dripping Leak",value:"Dripping"},{text:"ðŸš¿ Spraying Leak",value:"Spraying"}];
  else if(text.includes("clog")) options=[{text:"ðŸ½ï¸ Kitchen",value:"Kitchen"},{text:"ðŸš° Bathroom",value:"Bathroom"},{text:"ðŸš½ Toilet",value:"Toilet"}];
  else if(text.includes("faucet")) options=[{text:"ðŸ’§ Dripping Faucet",value:"Dripping"},{text:"âŒ Not Working Faucet",value:"Not working"}];
  else if(text.includes("toilet")) options=[{text:"ðŸ’§ Running Toilet",value:"Running"},{text:"ðŸš½ Not Flushing",value:"Not flushing"}];
  else if(text.includes("water heater")) options=[{text:"ðŸ”¥ Not Heating",value:"Not heating"},{text:"ðŸ’§ Water Heater Leak",value:"Leaking"}];

  if(options.length){
    addMessage("Please select the option that best matches your issue:");
    options.forEach(opt=>{
      const b=document.createElement('button'); b.className='option'; b.innerHTML=opt.text;
      b.onclick=()=>{ userData.detail=opt.value; addMessage(opt.value,'user'); document.querySelectorAll('.option').forEach(b=>b.remove()); if(!userData.floor) askFloor(); else finalizeEstimate();};
      chatBox.appendChild(b);
    });
  } else { if(!userData.floor) askFloor(); else finalizeEstimate(); }
}

function askFloor(){
  addMessage("Which floor is the issue on?");
  const floors=[{text:"ðŸ  First Floor", value:"First Floor"},{text:"ðŸ¢ Second Floor", value:"Second Floor"},{text:"ðŸ¡ Ground/Basement", value:"Ground Floor"}];
  floors.forEach(f=>{ const b=document.createElement('button'); b.className='option'; b.innerHTML=f.text; b.onclick=()=>{ userData.floor=f.value; addMessage(f.value,'user'); document.querySelectorAll('.option').forEach(b=>b.remove()); finalizeEstimate(); restartBtn.style.display='inline-block'; sendToEmail(); }; chatBox.appendChild(b); });
}

function finalizeEstimate(){
  let baseRange=serviceCosts["Other"];
  const text=userData.problem.toLowerCase();
  if(text.includes("leak")) baseRange=serviceCosts["Leak"];
  else if(text.includes("clog")) baseRange=serviceCosts["Clog"];
  else if(text.includes("faucet")) baseRange=serviceCosts["Faucet"];
  else if(text.includes("toilet")) baseRange=serviceCosts["Toilet"];
  else if(text.includes("water heater")) baseRange=serviceCosts["Water Heater"];
  let multiplier=1.0;
  if(userData.floor.toLowerCase().includes("second")) multiplier*=1.15;
  else if(userData.floor.toLowerCase().includes("ground")) multiplier*=1.1;
  if(userData.emergency) multiplier*=1.25;
  estimateResult.innerHTML=`Preliminary Local Estimate: $${Math.round(baseRange[0]*multiplier)} - $${Math.round(baseRange[1]*multiplier)} (Labor only)<br><em>Adjusted for San Antonio pricing and urgency.</em>`;
}

function sendToEmail(){
  fetch("https://formsubmit.co/pipeleaders@gmail.com",{ method:"POST", headers:{'Content-Type':'application/json'}, body:JSON.stringify(userData) });
}
</script>

</body>
</html>    const val=userInput.value.trim(); if(!val) return; addMessage(val,'user'); userInput.value='';
    userData.floor=val;
    finalizeEstimate();
  }
});

function finalizeEstimate(){
  let base=serviceCosts.Other; const text=userData.problem.toLowerCase();
  if(text.includes("leak")) base=serviceCosts.Leak;
  else if(text.includes("clog")) base=serviceCosts.Clog;
  else if(text.includes("faucet")) base=serviceCosts.Faucet;
  else if(text.includes("toilet")) base=serviceCosts.Toilet;
  else if(text.includes("heater")) base=serviceCosts["Water Heater"];

  let mult=1;
  if(userData.floor.toLowerCase().includes("second")) mult*=1.15;
  else if(userData.floor.toLowerCase().includes("ground")) mult*=1.1;
  if(userData.emergency) mult*=1.25;

  estimateResult.innerHTML=`Preliminary Estimate: $${Math.round(base[0]*mult)} - $${Math.round(base[1]*mult)} (Labor only)<br><em>Adjusted for San Antonio & emergency.</em>`;

  fetch("https://formsubmit.co/pipeleaders@gmail.com",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify(userData)});
  addMessage("âœ… Your info has been sent. You can book your service next.",'ai');
  restartBtn.style.display='inline-block';
}
</script>
</body>
</html>}

chatForm.addEventListener("submit", function(e){
    e.preventDefault();
    const name=document.getElementById("name").value.trim();
    const email=document.getElementById("email").value.trim();
    const phone=document.getElementById("phone").value.trim();
    const zip=document.getElementById("zip").value.trim();
    const serviceType=document.getElementById("serviceType").value;
    const serviceDetail=document.getElementById("serviceDetail").value;
    const userNotes=document.getElementById("userNotes").value.trim();
    
    displayMessage(`${name}, ${serviceType} - ${serviceDetail}`, "user");
    if(userNotes) displayMessage(userNotes, "user");
    
    const [min,max]=calculateLaborEstimate(serviceType, serviceDetail, zip);
    
    displayMessage(`Preliminary Labor Estimate: $${min} â€“ $${max}. Materials, permits, and additional equipment are extra. Final pricing confirmed after inspection by a licensed plumber.`, "bot");
    document.getElementById("estimateResult").innerHTML = `<strong>Preliminary Labor Estimate:</strong> $${min} â€“ $${max}<br><small>Materials, permits, and additional equipment are extra. Final pricing confirmed after inspection by a licensed plumber.</small>`;
    
    // Submit via FormSubmit
    const formData=new FormData();
    formData.append("name", name);
    formData.append("email", email);
    formData.append("phone", phone);
    formData.append("zip", zip);
    formData.append("serviceType", serviceType);
    formData.append("serviceDetail", serviceDetail);
    formData.append("notes", userNotes);
    formData.append("_captcha","false");
    formData.append("_subject","New AI Labor Estimate Submission");
    formData.append("_template","table");
    
    fetch("https://formsubmit.co/9f7e5896f9be69b62056c861f68e17e3", { method:"POST", body: formData });
});
</script>

<footer style="text-align:center; background:#00539C; color:white; padding:15px;">
<p>Â© 2025 Plumbing Gurus. Dispatch & referral services only.</p>
<p><a href="terms.html" style="color:white; text-decoration:underline;">Terms & Conditions</a> | 
<a href="privacy.html" style="color:white; text-decoration:underline;">Privacy Policy</a></p>
</footer>

</body>
</html>    if(!value) return;
    displayMessage(value,"user");
    if(currentQuestion < questions.length){
        answers[questions[currentQuestion].name] = value;
        currentQuestion++;
        chatInput.value="";
        showNextQuestion();
    } else {
        answers["notes"] = (answers["notes"] || "") + " " + value;
        chatInput.value="";
        calculateEstimate();
    }
});

// Pricing ranges
function getEstimate(service){
    let range = [150,450];
    if(service==="Repair") range = [150,500];
    else if(service==="Remodel") range = [500,5000];
    else if(service==="New Build") range = [1000,10000];
    return range;
}

// Local multiplier
function getLocalMultiplier(zip){
    const austinZips = [78701,78702,78703,78704,78705,78723,78741,78745,78746];
    const sanAntonioZips = [78201,78202,78203,78204,78205,78209,78210,78211,78212];
    zip = parseInt(zip) || 78251;
    if(austinZips.includes(zip)) return 1.08;
    if(sanAntonioZips.includes(zip)) return 1.00;
    return 1.00;
}

// Calculate estimate
function calculateEstimate(){
    if(!answers.service || !answers.zip) return;
    let [min,max] = getEstimate(answers.service);
    const multiplier = getLocalMultiplier(answers.zip);
    min *= multiplier;
    max *= multiplier;

    document.getElementById("estimateResult").innerHTML =
    `<strong>Preliminary Estimate:</strong> $${min.toFixed(0)} â€“ $${max.toFixed(0)}<br>
    <small>Final pricing confirmed after inspection by a licensed plumber.</small>`;

    // Submit data via FormSubmit
    const formData = new FormData();
    for(let key in answers){
        formData.append(key, answers[key]);
    }
    formData.append("_captcha","false");
    formData.append("_subject","New AI Estimate Submission");
    formData.append("_template","table");

    fetch("https://formsubmit.co/9f7e5896f9be69b62056c861f68e17e3", {
        method:"POST",
        body: formData
    });
}

showNextQuestion();
</script>

<footer style="text-align:center; background:#00539C; color:white; padding:15px;">
<p>Â© 2025 Plumbing Gurus. Dispatch & referral services only.</p>
<p><a href="terms.html" style="color:white; text-decoration:underline;">Terms & Conditions</a> | 
<a href="privacy.html" style="color:white; text-decoration:underline;">Privacy Policy</a></p>
</footer>

</body>
</html>
