<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Quick Chat AI Estimate | Plumbing Gurus</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; }
header { background: #00539C; color: white; padding: 15px; text-align:center; }
header img { height: 60px; margin-bottom: 10px; }
nav a { color: white; margin: 0 10px; text-decoration: none; }
.container { max-width: 700px; margin: 30px auto; background:white; padding:20px; border-radius:8px; box-shadow:0 4px 15px rgba(0,0,0,0.1);}
#chatMessages { max-height: 400px; overflow-y: auto; margin-bottom: 10px; }
.chat-message { display: flex; padding:10px; margin:5px 0; border-radius:10px; max-width: 80%; word-wrap: break-word; }
.bot-message { background:#e6f7ff; justify-content:flex-start; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
.user-message { background:#d3f4d3; justify-content:flex-end; margin-left:auto; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
.chat-message i { margin-right:8px; align-self:center; }
input, select, button { width: 100%; padding:10px; margin-top:5px; border-radius:5px; border:1px solid #ccc; }
button { background:#00539C; color:white; border:none; cursor:pointer; margin-top:10px; }
#estimateResult { margin-top: 20px; padding: 15px; background:#e6f7ff; border:1px solid #999; border-radius:5px; font-weight:bold; }
</style>
</head>
<body>

<header>
<img src="images/logo.png" alt="Plumbing Gurus Logo">
<h1>Quick Chat AI Plumbing Estimate</h1>
<nav>
<a href="index.html">Home</a> | 
<a href="services.html">Services</a> | 
<a href="contact.html">Contact</a>
</nav>
</header>

<div class="container">
<div id="chatMessages"></div>

<form id="chatForm" action="https://formsubmit.co/9f7e5896f9be69b62056c861f68e17e3" method="POST">
<input type="text" id="chatInput" placeholder="Type your message or info here..." required autocomplete="off">
<button type="submit"><i class="fa fa-paper-plane"></i> Send</button>
</form>

<div id="estimateResult"></div>
</div>

<script>
// Minimal questions
const questions = [
{name:"email", text:"Please enter your email:"},
{name:"phone", text:"Please enter your phone number:"},
{name:"zip", text:"What is your ZIP code?"},
{name:"service", text:"Select service type (New Build / Remodel / Repair):", type:"select", options:["New Build","Remodel","Repair"]}
];

let currentQuestion = 0;
const answers = {};

const chatMessages = document.getElementById("chatMessages");
const chatForm = document.getElementById("chatForm");
const chatInput = document.getElementById("chatInput");

function displayMessage(text, sender="bot"){
    const div = document.createElement("div");
    div.className = sender==="bot"?"chat-message bot-message":"chat-message user-message";
    const icon = document.createElement("i");
    icon.className = sender==="bot"?"fa fa-robot":"fa fa-user";
    div.appendChild(icon);
    const span = document.createElement("span");
    span.textContent = text;
    div.appendChild(span);
    chatMessages.appendChild(div);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function showNextQuestion(){
    if(currentQuestion >= questions.length){
        displayMessage("You can type any additional info or describe the problem below. We'll calculate your estimate automatically!");
        return;
    }
    const q = questions[currentQuestion];
    displayMessage(q.text);
    if(q.type==="select"){
        chatInput.value="";
        chatInput.setAttribute("list","options");
        if(!document.getElementById("options")) {
            const datalist = document.createElement("datalist");
            datalist.id="options";
            q.options.forEach(opt=>{
                const option = document.createElement("option");
                option.value=opt;
                datalist.appendChild(option);
            });
            document.body.appendChild(datalist);
        }
    } else {
        chatInput.type="text";
    }
}

chatForm.addEventListener("submit", function(e){
    e.preventDefault();
    const value = chatInput.value.trim();
    if(!value) return;
    displayMessage(value,"user");
    if(currentQuestion < questions.length){
        answers[questions[currentQuestion].name] = value;
        currentQuestion++;
        chatInput.value="";
        showNextQuestion();
    } else {
        answers["notes"] = (answers["notes"] || "") + " " + value;
        chatInput.value="";
        calculateEstimate();
    }
});

// Pricing ranges
function getEstimate(service){
    let range = [150,450];
    if(service==="Repair") range = [150,500];
    else if(service==="Remodel") range = [500,5000];
    else if(service==="New Build") range = [1000,10000];
    return range;
}

// Local multiplier
function getLocalMultiplier(zip){
    const austinZips = [78701,78702,78703,78704,78705,78723,78741,78745,78746];
    const sanAntonioZips = [78201,78202,78203,78204,78205,78209,78210,78211,78212];
    zip = parseInt(zip) || 78251;
    if(austinZips.includes(zip)) return 1.08;
    if(sanAntonioZips.includes(zip)) return 1.00;
    return 1.00;
}

// Calculate estimate
function calculateEstimate(){
    if(!answers.service || !answers.zip) return;
    let [min,max] = getEstimate(answers.service);
    const multiplier = getLocalMultiplier(answers.zip);
    min *= multiplier;
    max *= multiplier;

    document.getElementById("estimateResult").innerHTML =
    `<strong>Preliminary Estimate:</strong> $${min.toFixed(0)} – $${max.toFixed(0)}<br>
    <small>Final pricing confirmed after inspection by a licensed plumber.</small>`;

    // Submit data via FormSubmit
    const formData = new FormData();
    for(let key in answers){
        formData.append(key, answers[key]);
    }
    formData.append("_captcha","false");
    formData.append("_subject","New AI Estimate Submission");
    formData.append("_template","table");

    fetch("https://formsubmit.co/9f7e5896f9be69b62056c861f68e17e3", {
        method:"POST",
        body: formData
    });
}

showNextQuestion();
</script>

<footer style="text-align:center; background:#00539C; color:white; padding:15px;">
<p>© 2025 Plumbing Gurus. Dispatch & referral services only.</p>
<p><a href="terms.html" style="color:white; text-decoration:underline;">Terms & Conditions</a> | 
<a href="privacy.html" style="color:white; text-decoration:underline;">Privacy Policy</a></p>
</footer>

</body>
</html>
